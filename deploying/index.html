<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=../validation/ rel=prev><link href=../cicd/ rel=next><link rel=icon href=../images/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.17"><title>Deploying - Wakeflow</title><link rel=stylesheet href=../assets/stylesheets/main.bcfcd587.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#how-we-deploy class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title=Wakeflow class="md-header__button md-logo" aria-label=Wakeflow data-md-component=logo> <img src=../images/favicon.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Wakeflow </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Deploying </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/wakeflow/how-we-do title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title=Wakeflow class="md-nav__button md-logo" aria-label=Wakeflow data-md-component=logo> <img src=../images/favicon.png alt=logo> </a> Wakeflow </label> <div class=md-nav__source> <a href=https://github.com/wakeflow/how-we-do title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Coding </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Coding </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../good_software/ class=md-nav__link> <span class=md-ellipsis> Good Software </span> </a> </li> <li class=md-nav__item> <a href=../client_communication_principles/ class=md-nav__link> <span class=md-ellipsis> Client Communication Principles </span> </a> </li> <li class=md-nav__item> <a href=../contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> <li class=md-nav__item> <a href=../dotfiles/ class=md-nav__link> <span class=md-ellipsis> Dotfiles </span> </a> </li> <li class=md-nav__item> <a href=../javascript/ class=md-nav__link> <span class=md-ellipsis> Javascript </span> </a> </li> <li class=md-nav__item> <a href=../testing/ class=md-nav__link> <span class=md-ellipsis> Testing </span> </a> </li> <li class=md-nav__item> <a href=../api_requests/ class=md-nav__link> <span class=md-ellipsis> API Requests </span> </a> </li> <li class=md-nav__item> <a href=../dates/ class=md-nav__link> <span class=md-ellipsis> Dates </span> </a> </li> <li class=md-nav__item> <a href=../sorting_arrays/ class=md-nav__link> <span class=md-ellipsis> Sorting arrays </span> </a> </li> <li class=md-nav__item> <a href=../css/ class=md-nav__link> <span class=md-ellipsis> Styling </span> </a> </li> <li class=md-nav__item> <a href=../linting/ class=md-nav__link> <span class=md-ellipsis> Linting </span> </a> </li> <li class=md-nav__item> <a href=../secrets/ class=md-nav__link> <span class=md-ellipsis> Secrets </span> </a> </li> <li class=md-nav__item> <a href=../validation/ class=md-nav__link> <span class=md-ellipsis> Validation </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Deploying </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Deploying </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-branch-out class=md-nav__link> <span class=md-ellipsis> 1. Branch out </span> </a> </li> <li class=md-nav__item> <a href=#2-pull-request class=md-nav__link> <span class=md-ellipsis> 2. Pull Request </span> </a> </li> <li class=md-nav__item> <a href=#3-code-owner-review class=md-nav__link> <span class=md-ellipsis> 3. Code Owner Review </span> </a> </li> <li class=md-nav__item> <a href=#4-rebase class=md-nav__link> <span class=md-ellipsis> 4. Rebase </span> </a> </li> <li class=md-nav__item> <a href=#5-notify-on-slack class=md-nav__link> <span class=md-ellipsis> 5. Notify on Slack </span> </a> </li> <li class=md-nav__item> <a href=#6-merge class=md-nav__link> <span class=md-ellipsis> 6. Merge </span> </a> </li> <li class=md-nav__item> <a href=#7-smoke-test class=md-nav__link> <span class=md-ellipsis> 7. Smoke test </span> </a> </li> <li class=md-nav__item> <a href=#8-clean-up-branches class=md-nav__link> <span class=md-ellipsis> 8. Clean up branches </span> </a> </li> <li class=md-nav__item> <a href=#questions class=md-nav__link> <span class=md-ellipsis> Questions </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../cicd/ class=md-nav__link> <span class=md-ellipsis> CI/CD </span> </a> </li> <li class=md-nav__item> <a href=../firestore_backups/ class=md-nav__link> <span class=md-ellipsis> Firestore Backups </span> </a> </li> <li class=md-nav__item> <a href=../event_tracking/ class=md-nav__link> <span class=md-ellipsis> Event Tracking </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Professional Development </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Professional Development </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../trainingMaterials/ class=md-nav__link> <span class=md-ellipsis> Train </span> </a> </li> <li class=md-nav__item> <a href=../holidays/ class=md-nav__link> <span class=md-ellipsis> Holidays </span> </a> </li> <li class=md-nav__item> <a href=../progression/ class=md-nav__link> <span class=md-ellipsis> Progression </span> </a> </li> <li class=md-nav__item> <a href=../developer_bands/ class=md-nav__link> <span class=md-ellipsis> Developer Bands </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-branch-out class=md-nav__link> <span class=md-ellipsis> 1. Branch out </span> </a> </li> <li class=md-nav__item> <a href=#2-pull-request class=md-nav__link> <span class=md-ellipsis> 2. Pull Request </span> </a> </li> <li class=md-nav__item> <a href=#3-code-owner-review class=md-nav__link> <span class=md-ellipsis> 3. Code Owner Review </span> </a> </li> <li class=md-nav__item> <a href=#4-rebase class=md-nav__link> <span class=md-ellipsis> 4. Rebase </span> </a> </li> <li class=md-nav__item> <a href=#5-notify-on-slack class=md-nav__link> <span class=md-ellipsis> 5. Notify on Slack </span> </a> </li> <li class=md-nav__item> <a href=#6-merge class=md-nav__link> <span class=md-ellipsis> 6. Merge </span> </a> </li> <li class=md-nav__item> <a href=#7-smoke-test class=md-nav__link> <span class=md-ellipsis> 7. Smoke test </span> </a> </li> <li class=md-nav__item> <a href=#8-clean-up-branches class=md-nav__link> <span class=md-ellipsis> 8. Clean up branches </span> </a> </li> <li class=md-nav__item> <a href=#questions class=md-nav__link> <span class=md-ellipsis> Questions </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=how-we-deploy>How we deploy</h1> <p>When deploying a change to one of our repo's master branch we follow the following steps:</p> <h2 id=1-branch-out>1. Branch out</h2> <p>When making a change to any codebase on wakeflow's repos, the first step is to create a branch that will contain the change.</p> <p>Branch naming: The branch name should start with your initials, so that anyone can tell who created the branch. If I (Andreas Kater) wanted to update the CSS styling on our website, I'd create a branch called ak/css-updates with the command <code>gbo ak/css-updates</code> (install our dotfiles to get access to shortcuts like <code>gbo</code> <a href=/dotfiles.md>here</a>).</p> <p>I would then commit my changes to this branch.</p> <h2 id=2-pull-request>2. Pull Request</h2> <p>When the change is complete, we submit a pull request. The easiest way to do that is to checkout the branch with <code>gc ak/css-updates</code> and then create the PR with <code>gpr</code>.</p> <h2 id=3-code-owner-review>3. Code Owner Review</h2> <p>Every PR needs to be reviewed by a code owner of the repo. Github is configured in such a way that merging is not possible until this has taken place.</p> <h2 id=4-rebase>4. Rebase</h2> <p>Once you have approval from at least one other team member, you rebase your changes.</p> <p>This basically squashes all commits you have on your branch into a single one, so that the master branch only has one commit for all the changes you made on your branch. This keeps the git history of our master branch clean and easy to understand.</p> <p>For example, in updating the CSS on our website, I might have made the following 3 commits:</p> <p><img alt="Three commits" src=../images/three-commits.png></p> <p>Those commits are useful while I'm working on the branch, but in our master branch's git history we don't need that level of detail. We want a single message there, that tells us what happened at a higher level: <code>ak/css-updates</code>. This message is usually the branch name.</p> <p>To rebase: 1. <code>grbi origin/master</code> and then follow the instructions. 2. You should see someting like:</p> <pre><code>`pick 52a18f6 updated deploying.md`

`pick 35a32e9 updated images`

`pick b003d67 updates merge instructions`
</code></pre> <ol> <li> <p>Typically you'll want to edit this file like so:</p> <p><code>r 52a18f6 updated deploying.md</code> &lt;- the <code>r</code> stands for reword and lets you rename your commit message</p> <p><code>f 35a32e9 updated images</code> &lt;- the <code>f</code> stands for fixup and lets you incorporate these changes into the commit above, so that there is only one commit message</p> <p><code>f b003d67 updates merge instructions</code></p> </li> </ol> <h2 id=5-notify-on-slack>5. Notify on Slack</h2> <p>Once we have got approval from a code owner to merge, we notify the rest of the team on Slack.</p> <p>To do this, we send a message to the <code>#deploy</code> channel with the url of the PR we are about to merge, like so:</p> <p><img alt="PR on slack" src=../images/slack-pr.png></p> <p>When we merge in our changes on Github, Github Actions make sure that our code is deployed automatically.</p> <p>Therefore before merging, we want to make sure the team is alerted to the fact that a deploy is about to take place in case anything goes wrong and the rest of the team needs to step in to help.</p> <h2 id=6-merge>6. Merge</h2> <p>Once you have notified the team you can merge the PR.</p> <ol> <li>Check the git history is linear, by running <code>gl</code>. You should see someting like this:</li> </ol> <p><img alt="Linear Git History" src=../images/linear-history.png></p> <ol> <li>Check your branch is exactly one commit ahead of <code>master</code>. If not, rebase as explained above.</li> <li>Check out the master branch with <code>gc master</code></li> <li>Run <code>git merge ak/css-updates</code></li> </ol> <h2 id=7-smoke-test>7. Smoke test</h2> <p>After rebasing and merging, we make sure that the deploy completes successfully, by watching the github actions complete.</p> <p>Once the Github Actions have successfully completed, we do a smoke test of the application, to: 1. make sure everything works as expected 2. make sure your changes are now live</p> <h2 id=8-clean-up-branches>8. Clean up branches</h2> <p>Now that the change has been successfully deployed, we no longer need the feature branch. Therefore we delete it, both locally and remotely, using the command <code>gdbb ak/css-updates</code> (gdbb stands for git delete both branches).</p> <p>Run <code>gl</code> to check your feature branch is no longer there.</p> <p>Success! You're done.</p> <h2 id=questions>Questions</h2> <p>If you have any questions about this process, just slack Andi.</p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.1e8ae164.min.js></script> </body> </html>